<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lightbox Enhanced - Galerie d'images</title>
  <style>
    /* ===== LIGHTBOX CSS ===== */

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #1a1a1a;
      color: #fff;
      padding: 40px 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      margin-bottom: 40px;
      font-size: 2.5rem;
    }

    /* Galerie d'images */
    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    .gallery-item {
      position: relative;
      cursor: pointer;
      overflow: hidden;
      border-radius: 8px;
      aspect-ratio: 4/3;
      background: #2a2a2a;
    }

    .gallery-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }

    .gallery-item:hover img {
      transform: scale(1.05);
    }

    /* Lightbox overlay */
    .lightbox {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0);
      z-index: 9999;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .lightbox.active {
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.95);
    }

    /* Contenu de la lightbox */
    .lightbox-content {
      position: relative;
      max-width: 90%;
      max-height: 90vh;
      cursor: default;
      opacity: 0;
      transform: scale(0.9);
      transition: opacity 0.3s ease, transform 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
    }

    .lightbox.active .lightbox-content {
      opacity: 1;
      transform: scale(1);
      pointer-events: auto;
    }

    .lightbox-image-wrapper {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 300px;
      min-height: 300px;
    }

    .lightbox-image {
      max-width: 90vw;
      max-height: 80vh;
      display: block;
      border-radius: 4px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      opacity: 1;
      transition: opacity 0.3s ease;
    }

    /* Bouton de fermeture */
    .lightbox-close {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      background: transparent;
      border: none;
      cursor: pointer;
      padding: 0;
      z-index: 10001;
    }

    .lightbox-close::before,
    .lightbox-close::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 30px;
      height: 2px;
      background: #fff;
      transition: all 0.3s ease;
    }

    .lightbox-close::before {
      transform: translate(-50%, -50%) rotate(45deg);
    }

    .lightbox-close::after {
      transform: translate(-50%, -50%) rotate(-45deg);
    }

    .lightbox-close:hover::before {
      transform: translate(-50%, -50%) rotate(135deg);
    }

    .lightbox-close:hover::after {
      transform: translate(-50%, -50%) rotate(45deg);
    }

    /* Flèches de navigation */
    .lightbox-nav {
      position: fixed;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255, 255, 255, 0.1);
      border: none;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      z-index: 10001;
    }

    .lightbox-nav:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-50%) scale(1.1);
    }

    .lightbox-nav.prev {
      left: 20px;
    }

    .lightbox-nav.next {
      right: 20px;
    }

    .lightbox-nav::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 12px;
      height: 12px;
      border-top: 2px solid #fff;
      border-right: 2px solid #fff;
    }

    .lightbox-nav.prev::before {
      transform: translate(-30%, -50%) rotate(-135deg);
    }

    .lightbox-nav.next::before {
      transform: translate(-70%, -50%) rotate(45deg);
    }

    /* Zones de navigation cliquables */
    .lightbox-nav-area {
      position: fixed;
      top: 0;
      bottom: 0;
      width: 40%;
      cursor: pointer;
      z-index: 10000;
      display: flex;
      align-items: center;
    }

    .lightbox-nav-area.prev-area {
      left: 0;
      justify-content: flex-start;
      padding-left: 20px;
    }

    .lightbox-nav-area.next-area {
      right: 0;
      justify-content: flex-end;
      padding-right: 20px;
    }

    /* Zone centrale pour fermer (entre les deux zones de navigation) */
    .lightbox-center-area {
      position: fixed;
      top: 60px;
      bottom: 100px;
      left: 40%;
      right: 40%;
      cursor: pointer;
      z-index: 9998;
    }

    /* Caption et compteur */
    .lightbox-caption {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
      color: #fff;
      font-size: 14px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      z-index: 10000;
    }

    .lightbox-title {
      font-size: 16px;
      font-weight: 500;
    }

    .lightbox-counter {
      font-size: 14px;
      opacity: 0.7;
    }

    /* Animation de transition entre images */
    .lightbox-image.fade-out {
      animation: fadeOut 0.2s ease;
    }

    .lightbox-image.fade-in {
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeOut {
      from {
        opacity: 1;
      }

      to {
        opacity: 0;
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    /* Loading spinner */
    .lightbox-loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 50px;
      height: 50px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to {
        transform: translate(-50%, -50%) rotate(360deg);
      }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .lightbox-close {
        top: 10px;
        right: 10px;
        width: 35px;
        height: 35px;
      }

      .lightbox-close::before,
      .lightbox-close::after {
        width: 25px;
      }

      .lightbox-nav {
        width: 40px;
        height: 40px;
      }

      .lightbox-nav.prev {
        left: 10px;
      }

      .lightbox-nav.next {
        right: 10px;
      }

      .lightbox-caption {
        bottom: 20px;
      }

      /* Désactiver les zones de navigation étendues sur mobile */
      .lightbox-nav-area {
        display: none;
      }

      .lightbox-center-area {
        display: none;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>Lightbox Enhanced - Galerie</h1>

    <!-- GALERIE : Deux méthodes possibles -->

    <!-- MÉTHODE 1 : Liste manuelle (compatible GitHub Pages) -->
    <div class="gallery" data-lightbox-images='[
                "images/dossier_images_01/custom_001.webp",
                "images/dossier_images_01/custom_002.webp",
                "images/dossier_images_01/custom_003.webp"
              ]'>
    </div>

    <!-- MÉTHODE 2 : Scan automatique (fonctionne uniquement avec Live Server) -->
    <!-- <div class="gallery" data-lightbox-folder="images/dossier_images_01"></div> -->
  </div>

  <!-- Structure de la lightbox (générée automatiquement par le script) -->
  <div class="lightbox" id="lightbox">
    <button class="lightbox-close" id="closeBtn" aria-label="Fermer"></button>


    <!-- Zones de navigation cliquables -->
    <div class="lightbox-nav-area prev-area" id="prevArea"></div>
    <div class="lightbox-nav-area next-area" id="nextArea"></div>
    <div class="lightbox-center-area" id="centerArea"></div>

    <!-- Boutons de navigation visibles -->
    <button class="lightbox-nav prev" id="prevBtn" aria-label="Image précédente"></button>
    <button class="lightbox-nav next" id="nextBtn" aria-label="Image suivante"></button>

    <div class="lightbox-content" id="lightboxContent">
      <div class="lightbox-image-wrapper">
        <img class="lightbox-image" id="lightboxImage" src="" alt="">
      </div>
    </div>

    <div class="lightbox-caption">
      <div class="lightbox-title" id="lightboxTitle"></div>
      <div class="lightbox-counter" id="lightboxCounter"></div>
    </div>
  </div>

  <script>
    /* ===== LIGHTBOX JAVASCRIPT ===== */

    /**
     * Lightbox Enhanced - Charge automatiquement les images depuis un dossier
     * Pour chaque page, modifiez uniquement l'attribut data-lightbox-folder
     */

    class LightboxEnhanced {
      constructor() {
        this.images = [];
        this.currentIndex = 0;
        this.isTransitioning = false;
        this.imageExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp', 'svg'];

        this.init();
      }

      init() {
        // Récupérer les éléments du DOM
        this.gallery = document.querySelector('.gallery');
        this.lightbox = document.getElementById('lightbox');
        this.lightboxContent = document.getElementById('lightboxContent');
        this.lightboxImage = document.getElementById('lightboxImage');
        this.lightboxTitle = document.getElementById('lightboxTitle');
        this.lightboxCounter = document.getElementById('lightboxCounter');
        this.closeBtn = document.getElementById('closeBtn');
        this.prevBtn = document.getElementById('prevBtn');
        this.nextBtn = document.getElementById('nextBtn');
        this.prevArea = document.getElementById('prevArea');
        this.nextArea = document.getElementById('nextArea');
        this.centerArea = document.getElementById('centerArea');

        // Vérifier la méthode de chargement des images
        const imagesList = this.gallery.getAttribute('data-lightbox-images');
        const imageFolder = this.gallery.getAttribute('data-lightbox-folder');

        if (imagesList) {
          // Méthode 1 : Liste d'images fournie directement
          this.loadImagesFromList(imagesList);
        } else if (imageFolder) {
          // Méthode 2 : Scanner le dossier (nécessite un serveur avec listing)
          this.loadImagesFromFolder(imageFolder);
        } else {
          console.error('Lightbox: Attribut data-lightbox-images ou data-lightbox-folder manquant');
        }

        // Initialiser les événements
        this.initEvents();
      }

      loadImagesFromList(imagesList) {
        try {
          const imagePaths = JSON.parse(imagesList);

          this.images = imagePaths.map(path => {
            const filename = this.getFilenameWithoutExtension(path);
            return {
              src: path,
              title: filename
            };
          });

          if (this.images.length > 0) {
            console.log('Total images chargées:', this.images.length);
            this.createGallery();
          } else {
            this.showMessage('Aucune image dans la liste');
          }
        } catch (error) {
          console.error('Lightbox: Erreur lors du parsing de la liste d\'images', error);
          this.showMessage('Erreur lors du chargement de la liste d\'images');
        }
      }

      async loadImagesFromFolder(folderPath) {
        try {
          // Normaliser le chemin du dossier
          const normalizedPath = folderPath.endsWith('/') ? folderPath : folderPath + '/';

          // Scanner les images du dossier via une requête au serveur
          const response = await fetch(normalizedPath);
          const text = await response.text();

          // Parser le HTML pour extraire les liens vers les images
          const parser = new DOMParser();
          const doc = parser.parseFromString(text, 'text/html');
          const links = doc.querySelectorAll('a');

          this.images = [];
          links.forEach(link => {
            let href = link.getAttribute('href');
            if (href && this.isImageFile(href)) {
              // Nettoyer le href (enlever ./ et ../)
              href = href.replace(/^\.\//, '');

              // Construire le chemin complet de l'image
              let imagePath;
              if (href.startsWith('http://') || href.startsWith('https://') || href.startsWith('/')) {
                // URL absolue
                imagePath = href;
              } else {
                // URL relative - combiner avec le chemin du dossier
                imagePath = normalizedPath + href;
              }

              const filename = this.getFilenameWithoutExtension(href);
              this.images.push({
                src: imagePath,
                title: filename
              });

              console.log('Image trouvée:', imagePath); // Debug
            }
          });

          if (this.images.length > 0) {
            console.log('Total images chargées:', this.images.length); // Debug
            this.createGallery();
          } else {
            console.warn('Lightbox: Aucune image trouvée dans le dossier ' + folderPath);
            this.showMessage('Aucune image trouvée dans ce dossier');
          }
        } catch (error) {
          console.error('Lightbox: Erreur lors du chargement des images', error);
          this.showMessage('Erreur lors du chargement des images. Assurez-vous d\'utiliser un serveur web.');
        }
      }

      createGallery() {
        // Générer le HTML de la galerie
        this.gallery.innerHTML = this.images.map((img, index) => `
                    <div class="gallery-item" data-index="${index}">
                        <img src="${img.src}" alt="${img.title}" loading="lazy">
                    </div>
                `).join('');

        // Ajouter les événements de clic
        document.querySelectorAll('.gallery-item').forEach(item => {
          item.addEventListener('click', () => {
            this.open(parseInt(item.dataset.index));
          });
        });
      }

      showMessage(message) {
        this.gallery.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 40px; color: #999;">
                        ${message}
                    </div>
                `;
      }

      isImageFile(filename) {
        const ext = filename.split('.').pop().toLowerCase();
        return this.imageExtensions.includes(ext);
      }

      getFilenameWithoutExtension(path) {
        const filename = path.split('/').pop();
        return filename.replace(/\.[^/.]+$/, '').replace(/-|_/g, ' ');
      }

      open(index) {
        this.currentIndex = index;
        this.updateLightbox();
        this.lightbox.classList.add('active');
        document.body.style.overflow = 'hidden';
      }

      close() {
        this.lightbox.classList.remove('active');
        document.body.style.overflow = '';
      }

      updateLightbox() {
        if (this.isTransitioning || this.images.length === 0) return;

        this.isTransitioning = true;
        const img = this.images[this.currentIndex];

        // Créer une nouvelle image pour précharger
        const newImage = new Image();

        newImage.onload = () => {
          // Animation de fondu sortant
          this.lightboxImage.style.opacity = '0';

          setTimeout(() => {
            // Changer l'image
            this.lightboxImage.src = img.src;
            this.lightboxImage.alt = img.title;
            this.lightboxTitle.textContent = img.title;
            this.lightboxCounter.textContent = `${this.currentIndex + 1} / ${this.images.length}`;

            // Animation de fondu entrant
            setTimeout(() => {
              this.lightboxImage.style.opacity = '1';
              setTimeout(() => {
                this.isTransitioning = false;
              }, 300);
            }, 50);
          }, 200);
        };

        // Précharger l'image
        newImage.src = img.src;
      }

      showNext() {
        if (this.isTransitioning) return;
        this.currentIndex = (this.currentIndex + 1) % this.images.length;
        this.updateLightbox();
      }

      showPrev() {
        if (this.isTransitioning) return;
        this.currentIndex = (this.currentIndex - 1 + this.images.length) % this.images.length;
        this.updateLightbox();
      }

      initEvents() {
        // Bouton fermer
        this.closeBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          this.close();
        });

        // Boutons de navigation
        this.nextBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          this.showNext();
        });

        this.prevBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          this.showPrev();
        });

        // Zones de navigation étendues
        this.prevArea.addEventListener('click', (e) => {
          e.stopPropagation();
          this.showPrev();
        });

        this.nextArea.addEventListener('click', (e) => {
          e.stopPropagation();
          this.showNext();
        });

        // Zone centrale pour fermer
        this.centerArea.addEventListener('click', (e) => {
          e.stopPropagation();
          this.close();
        });

        // Fermer en cliquant sur l'overlay (au cas où)
        this.lightbox.addEventListener('click', (e) => {
          if (e.target === this.lightbox) {
            this.close();
          }
        });

        // Empêcher la fermeture lors du clic sur le contenu
        this.lightboxContent.addEventListener('click', (e) => {
          e.stopPropagation();
        });

        // Empêcher la fermeture lors du clic sur les boutons
        this.closeBtn.addEventListener('click', (e) => {
          e.stopPropagation();
        });

        this.prevBtn.addEventListener('click', (e) => {
          e.stopPropagation();
        });

        this.nextBtn.addEventListener('click', (e) => {
          e.stopPropagation();
        });

        // Navigation au clavier
        document.addEventListener('keydown', (e) => {
          if (!this.lightbox.classList.contains('active')) return;

          switch (e.key) {
            case 'Escape':
              this.close();
              break;
            case 'ArrowRight':
              this.showNext();
              break;
            case 'ArrowLeft':
              this.showPrev();
              break;
          }
        });
      }
    }

    // Initialisation automatique au chargement du DOM
    document.addEventListener('DOMContentLoaded', () => {
      window.lightbox = new LightboxEnhanced();
    });
  </script>
</body>

</html>